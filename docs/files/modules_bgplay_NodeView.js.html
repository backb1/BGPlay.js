<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>modules\bgplay\NodeView.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/BgpDataChecksView.html">BgpDataChecksView</a></li>
            
                <li><a href="..&#x2F;classes/Bgplay.html">Bgplay</a></li>
            
                <li><a href="..&#x2F;classes/Cluster.html">Cluster</a></li>
            
                <li><a href="..&#x2F;classes/ControllerQuerySimpleView.html">ControllerQuerySimpleView</a></li>
            
                <li><a href="..&#x2F;classes/ControllerView.html">ControllerView</a></li>
            
                <li><a href="..&#x2F;classes/Event.html">Event</a></li>
            
                <li><a href="..&#x2F;classes/GraphView.html">GraphView</a></li>
            
                <li><a href="..&#x2F;classes/InfoPanelView.html">InfoPanelView</a></li>
            
                <li><a href="..&#x2F;classes/Instant.html">Instant</a></li>
            
                <li><a href="..&#x2F;classes/JsonWrapGeneric.html">JsonWrapGeneric</a></li>
            
                <li><a href="..&#x2F;classes/JsonWrapRipestat.html">JsonWrapRipestat</a></li>
            
                <li><a href="..&#x2F;classes/JsonWrapTraceroutes.html">JsonWrapTraceroutes</a></li>
            
                <li><a href="..&#x2F;classes/LegendView.html">LegendView</a></li>
            
                <li><a href="..&#x2F;classes/MainView.html">MainView</a></li>
            
                <li><a href="..&#x2F;classes/Node.html">Node</a></li>
            
                <li><a href="..&#x2F;classes/NodePositionView.html">NodePositionView</a></li>
            
                <li><a href="..&#x2F;classes/NodeView.html">NodeView</a></li>
            
                <li><a href="..&#x2F;classes/OptionAnimationSpeedView.html">OptionAnimationSpeedView</a></li>
            
                <li><a href="..&#x2F;classes/OptionPopupView.html">OptionPopupView</a></li>
            
                <li><a href="..&#x2F;classes/Path.html">Path</a></li>
            
                <li><a href="..&#x2F;classes/PathView.html">PathView</a></li>
            
                <li><a href="..&#x2F;classes/Source.html">Source</a></li>
            
                <li><a href="..&#x2F;classes/Target.html">Target</a></li>
            
                <li><a href="..&#x2F;classes/TimelineView.html">TimelineView</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/model.html">model</a></li>
            
                <li><a href="..&#x2F;modules/modules.html">modules</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: modules\bgplay\NodeView.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;*
 * BGPlay.js
 * Copyright (c) 2013 Massimo Candela, Giuseppe Di Battista, Claudio Squarcella, Roma Tre University and RIPE NCC
 * http:&#x2F;&#x2F;www.bgplayjs.com
 *
 * See the file LICENSE.txt for copying permission.
 *&#x2F;

&#x2F;**
 * @class NodeView
 * @module modules
 *&#x2F;
var NodeView=Backbone.View.extend({

    &#x2F;**
     * The initialization method of this object.
     * @method initialize
     * @param {Map} A map of parameters
     *&#x2F;
    initialize:function(){
        this.environment=this.options.environment;
        this.bgplay=this.environment.bgplay;
        this.fileRoot=this.environment.fileRoot;
        this.eventAggregator=this.environment.eventAggregator;

        this.model=this.options.model;
        this.id=this.model.id;
        this.model.view=this;
        this.paper=this.options.paper;
        this.paperOriginalWidth=this.paper.width; &#x2F;&#x2F;Used by Mustache.js
        this.paperOriginalHeight=this.paper.height; &#x2F;&#x2F;Used by Mustache.js
        this.graphView=this.options.graphView;
        this.visible=this.options.visible;
        this.x=Math.floor(Math.random()*100);
        this.y=Math.floor(Math.random()*100);
        this.oldX=this.x;
        this.oldY=this.y;
        this.selected=false;
        this.neighbors = new net.webrobotics.TreeMap(comparator, {allowDuplicateKeys:false, suppressDuplicateKeyAlerts:true});
        this.nodeWidth=this.environment.config.graph.nodeWidth;
        this.nodeHeight=this.environment.config.graph.nodeHeight;
        this.render();
        this.eventsManager();
    },

    eventsManager: function(){
        this.eventAggregator.on(&quot;destroyAll&quot;, function(){
            this.destroyMe();
        },this);

        this.model.on(&#x27;change&#x27;,this.render,this);

        this.eventAggregator.on(&quot;updateNodesPosition&quot;,function(){
            this.updatePosition();
        },this);

        this.eventAggregator.on(&quot;styleElement&quot;,function(style){
            if (!this.selected &amp;&amp; this.visible){
                this.setSvgStyle(style);
            }
        },this);

        this.eventAggregator.on(&quot;nodeSelected&quot;,function(node){
            if (node == this){
                this.highlight(true);
            }
        },this);

        this.eventAggregator.on(&quot;nodeReleased&quot;,function(node){
            if (node == this){
                this.highlight(false);
            }
        },this);
    },

    &#x2F;**
     * This method is used to update the position of the SVG representation of the node.
     * The new position will be (this.x,this.y) of this NodeView.
     * @method updatePosition
     *&#x2F;
    updatePosition:function(){
        this.view.translate(this.x-this.oldX, this.y-this.oldY,this);
        this.oldX = this.x;
        this.oldY = this.y;
        this.eventAggregator.trigger(&quot;nodeMoved&quot;,this.model);
    },

    &#x2F;**
     * This method is used to translate the position of the SVG representation of the node.
     * The current position will be translated of (x,y) passed as parameters.
     * @method translate
     * @param {Float} The x position
     * @param {Float} The y position
     *&#x2F;
    translate:function(x,y,$this){
        if (!$this)
            $this=this;

        $this.view.translate(x,y);
        $this.x+=x;
        $this.y+=y;
        $this.eventAggregator.trigger(&quot;nodeMoved&quot;,$this.model);
    },

    &#x2F;**
     * This method draws this module (eg. inject the DOM and elements).
     * @method render
     *&#x2F;
    render: function(){
        var radiusForRoundedCorners = 10;

        var svgNode = this.paper.rect(this.x-this.nodeWidth&#x2F;2,this.y-this.nodeHeight&#x2F;2, this.nodeWidth,this.nodeHeight,radiusForRoundedCorners)
            .attr({fill: this.getFillColor(), stroke:this.getStrokeColor(),&quot;text-anchor&quot;: &quot;middle&quot;});

        var svgText = this.paper.text(this.x,this.y, this.getLabel())
            .attr({&#x27;fill&#x27;:this.getTextFillColor(),&#x27;font-family&#x27;:&#x27;Arial&#x27;,&#x27;font-size&#x27;:this.environment.config.graph.nodeTextFontSize,&#x27;font-weight&#x27;:&#x27;bold&#x27;});

        var group = this.paper.set();
        group.push(svgNode);
        group.push(svgText);
        svgNode[&quot;set&quot;] = group;
        svgText[&quot;set&quot;] = group;

        svgNode.parentGroup = group;
        svgText.parentGroup = group;

        this.paper.graphSet.push(svgNode);
        this.paper.graphSet.push(svgText);

        if (this.visible == false){
            group.hide();
        }else{
            group.show();
        }

        this.el = group.node;
        this.view = group;

        $(svgNode.node).css(&quot;cursor&quot;,&quot;pointer&quot;);
        $(svgText.node).css(&quot;cursor&quot;,&quot;pointer&quot;);

        this.loadSvgEvents();
        return this;
    },
    selectedStyle:function(){
        this.view[0].attr(
            {
                opacity: 0.75,
                fill:&quot;#E3F8FA&quot;,
                stroke:this.getStrokeColor()
            });

        this.view[1].attr(
            {
                &#x27;fill&#x27;:this.getTextFillColor()
            });
    },
    unSelectedStyle:function(){
        this.view[0].attr({
            opacity: 1,
            fill:this.getFillColor()
        });
    },

    select:function(){
        if (arrayContains(this.graphView.selectedNodes, this) == false){
            this.graphView.selectedNodes.push(this);
            this.selected = true;
            this.selectedStyle();

            var $this = this;
            this.selecChildrenTimer = setTimeout(function(){
                $this.eventAggregator.trigger(&quot;selectChildren&quot;, $this.model);
            }, $this.environment.config.graph.nodeSelectChildrenMilliseconds);

        }else{
            this.graphView.selectedNodes = removeArrayElement(this.graphView.selectedNodes,this);
            this.selected = false;
            this.unSelectedStyle();
        }
        this.dragging = false;
    },

    &#x2F;**
     * This method manages the events for the SVG representation.
     * @method loadSvgEvents
     *&#x2F;
    loadSvgEvents:function(){
        if (!isMobileBrowser()){
            var $this;
            $this = this;
            $this.clicks=0;

            $(this.view[1].node).mouseenter(function(evt){
                if (!$this.dragging){
                    eventStopPropagation(evt);

                    $this.mouseoverTimer = setTimeout(function(){
                        $this.eventAggregator.trigger(&quot;styleElement&quot;, {opacity: $this.environment.config.graph.notSelectedElementOpacity});
                        $this.setSvgStyle({opacity:1});
                        $this.eventAggregator.trigger(&quot;nodeSelected&quot;, $this);

                    }, $this.environment.config.graph.nodeMouseoverMilliseconds);

                }
            });


            $(this.view[1].node).mouseleave(function(evt){
                if (!$this.dragging){
                    clearTimeout($this.mouseoverTimer);
                    eventStopPropagation(evt);
                    $this.eventAggregator.trigger(&quot;styleElement&quot;,{opacity: 1});
                    $this.eventAggregator.trigger(&quot;nodeReleased&quot;, $this);
                }
            });

            function removeClicks(){
                $this.clicks=0;
            }

            $(this.paper.node).dblclick(function(event){
                if ($($(event.target).context.parentNode).hasClass(&#x27;bgplayNodeContainer&#x27;)){
                    eventStopPropagation(event);
                    $this.unSelectedStyle();
                    $this.selected=false;
                }
            });

            function singleClick(event){
                eventStopPropagation(event);
                event.preventDefault();
                $this.view.toFront();
                $this.ox = event.screenX;
                $this.oy = event.screenY;
                $this.selectedStyle();
                $this.dragging = true;
                clearTimeout($this.mouseoverTimer);
            }

            function doubleClick(event){
                eventStopPropagation(event);
                event.preventDefault();
                $this.select();
            }

            $(this.view[0].node).add(this.view[1].node).mousedown(function(event) {
                if ($($(event.target).context.parentNode).hasClass(&#x27;bgplayNodeContainer&#x27;)==false){
                    $this.clicks++;
                    setTimeout(removeClicks,$this.environment.config.doubleClickTimeInterval);
                    if($this.clicks&gt;1){
                        removeClicks();
                        doubleClick(event);
                    }else{
                        singleClick(event);
                    }
                }
            });


            this.paper.node.mouseleave(function(event){
                eventStopPropagation(event);
                $this.dragging = false;
            });

            this.paper.node.mousemove(function(event) {
                if ($this.dragging==true) {
                    if ($this.selected)$this.graphView.draggingNodes = true;
                    var x = (event.screenX - $this.ox) * $this.paper[&quot;scale&quot;];
                    var y = (event.screenY - $this.oy) * $this.paper[&quot;scale&quot;];
                    $this.translate(x,y,$this);
                    $this.ox = event.screenX;
                    $this.oy = event.screenY;
                    if ($this.graphView.draggingNodes==true &amp;&amp; $this.selected==true){
                        $this.graphView.selectedNodes.forEach(function(node){
                            if (node.id != $this.id){
                                node.translate(x,y,node);
                            }
                        });
                    }
                }
            });

            this.paper.node.mouseup(function(event) {
                eventStopPropagation(event);
                if($this.selected==false){
                    $this.unSelectedStyle();
                }
                $this.dragging = false;
                $this.graphView.draggingNodes=false;
                clearTimeout($this.selecChildrenTimer);
            });
        }
    },

    setSvgStyle:function(style){
        var view = this.view;
        if (view != null){
            for(var key in style){ &#x2F;&#x2F;it is a map!
                if (view.attr(key) != style[key]){ &#x2F;&#x2F;There is a difference
                    view.attr(style);
                    break;
                }
            }
        }
    },

    &#x2F;**
     * This method returns the background colour of the node.
     * @method getFillColor
     * @return {String} An hexadecimal colour
     *&#x2F;
    getFillColor:function(){
        var color;
        switch(this.bgplay.get(&quot;type&quot;)){
            default:
                if (this.model.get(&quot;targets&quot;).length&gt;0){
                    color=this.environment.config.graph.targetColor;
                }else if (this.model.get(&quot;sources&quot;).length&gt;0){
                    color=this.environment.config.graph.sourceColor;
                }else{
                    color=this.environment.config.graph.nodeColor;
                }
                break;
        }
        return color;
    },

    &#x2F;**
     * This method returns the border colour of the node.
     * @method getStrokeColor
     * @return {String} An hexadecimal colour
     *&#x2F;
    getStrokeColor:function(){
        var color;
        switch(this.bgplay.get(&quot;type&quot;)){
            default:
                if (this.model.get(&quot;targets&quot;).length&gt;0){
                    color=this.environment.config.graph.targetBorderColor;
                }else if (this.model.get(&quot;sources&quot;).length&gt;0){
                    color=this.environment.config.graph.sourceBorderColor;
                }else{
                    color=this.environment.config.graph.nodeBorderColor;
                }
                break;
        }
        return color;
    },

    &#x2F;**
     * This method returns the text colour of the node.
     * @method getTextFillColor
     * @return {String} An hexadecimal colour
     *&#x2F;
    getTextFillColor:function(){
        var color;
        switch(this.bgplay.get(&quot;type&quot;)){
            default:
                if (this.model.get(&quot;sources&quot;).length&gt;0){
                    color=this.environment.config.graph.sourceTextColor;
                }else if (this.model.get(&quot;targets&quot;).length&gt;0){
                    color=this.environment.config.graph.targetTextColor;
                }else{
                    color=this.environment.config.graph.nodeTextColor;
                }
                break;
        }
        return color;
    },

    &#x2F;**
     * This method returns the label of the node.
     * @method getLabel
     * @return {String} The label of the node
     *&#x2F;
    getLabel:function(){
        return this.model.toString();
    },

    &#x2F;**
     * This method highlights the node.
     * @method highlight
     * @param {Boolean} if true the node will be highlighted
     *&#x2F;
    highlight:function(light){
        if (!this.selected){
            if (light){
                this.view[0].attr(
                    {
                        fill: this.getTextFillColor(),
                        stroke:this.getFillColor()
                    });

                this.view[1].attr(
                    {
                        &#x27;fill&#x27;:this.getFillColor()
                    });
            }else{
                this.view[0].attr(
                    {
                        fill: this.getFillColor(),
                        stroke:this.getStrokeColor()
                    });

                this.view[1].attr(
                    {
                        &#x27;fill&#x27;:this.getTextFillColor()
                    });
            }
        }
    },

    addNeighbor:function(node){
        this.neighbors.put(node.id, node);
    },

    getNeighbors:function(){
        return this.neighbors.toArray();
    }

});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
